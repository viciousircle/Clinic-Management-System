@page
@model OOP_Final_Project.Pages.Inventory.InventoryManagementModel
@{
    ViewData["Title"] = "Inventory Management";
}

<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>

<div class="container-fluid mt-5">
    <div class="row">
        <!-- Sidebar Section -->
        <div class="col-md-3 col-lg-2 p-3 text-dark">
            <div class="list-group">
                <a href="@Url.Page("/Inventory/InventoryDashBoard")" class="list-group-item list-group-item-action">
                    Dashboard
                </a>
                <a href="@Url.Page("/Inventory/InventoryManagement")" class="list-group-item list-group-item-secondary">
                    Inventory
                </a>
                <a href="@Url.Page("/Inventory/PrescribeManagement")" class="list-group-item list-group-item-action">
                    Prescribe
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    Doctors
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    Reports
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    Settings
                </a>
            </div>
        </div>

        <!-- Main Content Section -->
        <div class="col-md-9 col-lg-10">
            <div class="text-center mb-4">
                <h1 class="fw-bold">Inventory Management</h1>
                <p class="text-muted">Manage medicines and stock levels efficiently.</p>
            </div>

            <!-- Action Buttons Group -->
            <div class="container mt-4">
                <div class="d-flex justify-content-center">
                    <div class="btn-group" role="group" aria-label="Inventory Actions">
                        <button class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#addMedicineModal">
                            <i class="fas fa-plus-circle me-2"></i> Add New Medicine
                        </button>
                        <button class="btn btn-dark ms-2">
                            <i class="fas fa-file-import me-2"></i> Add List Medicine
                        </button>
                        <button class="btn btn-warning ms-2">
                            <i class="fas fa-edit me-2"></i> Edit List Medicine
                        </button>
                        <button class="btn btn-danger ms-2" data-bs-toggle="modal"
                            data-bs-target="#expiredMedicineModal">
                            <i class="fas fa-trash me-2"></i> Show Expired Medicines
                        </button>
                        <button class="btn btn-dark ms-2" id="moreActionsBtn">
                            <i class="fas fa-cogs me-2"></i> More Actions
                        </button>
                    </div>
                </div>

                <div class="d-flex justify-content-center">
                    <div id="moreActions" class="mt-3" style="display: none;">
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-dark ms-2">
                                <i class="fas fa-file-export me-2"></i> Export List Medicine
                            </button>
                            <button class="btn btn-danger ms-2">
                                <i class="fas fa-file-pdf me-2"></i> Export PDF
                            </button>
                            <button class="btn btn-secondary ms-2">
                                <i class="fas fa-print me-2"></i> Print List Medicine
                            </button>
                        </div>
                    </div>
                </div>


            </div>


            <!-- More Actions Button -->
            <div class="container mt-4">


            </div>

            <div class="container mt-4 bg-dark text-white rounded">
                <!-- Search and Filter Section -->
                <div class="row mb-3 pt-4 ">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text bg-dark border-light text-white"><i
                                    class="fas fa-search"></i></span>
                            <input type="text" class="form-control bg-dark text-white border-light " id="searchMedicine"
                                placeholder="Search by Name or Type">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-control bg-dark text-white border-light" id="filterType">
                            <option value="" class="text-dark">Filter None</option>
                            <option value="Tablet" class="text-dark">Tablet</option>
                            <option value="Syrup" class="text-dark">Syrup</option>
                            <option value="Injection" class="text-dark">Injection</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-light w-100" id="sortExpiryBtn">
                            <i class="fas fa-sort me-2"></i> Sort by Expiry Date
                        </button>
                    </div>
                </div>
                <div class="row mb-3">
                    <!-- Inventory List Section -->
                    <div class="container mt-4 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light text-dark">
                                <i class="fas fa-list me-2"></i> Current Inventory
                            </div>
                            <div class="card-body">


                                <!-- Inventory Table -->
                                <table class="table table-striped table-hover table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Medicine Name</th>
                                            <th>Type</th>
                                            <th>Quantity</th>
                                            <th>Expiry Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTableBody">
                                        @foreach (var medicine in Model.Medicines)
                                        {
                                            <tr class="@(medicine.ExpiryDate < DateTime.Now ? "table-danger" : "")">
                                                <td>@medicine.Name</td>
                                                <td>@medicine.Type</td>
                                                <td>@medicine.Quantity</td>
                                                <td>@medicine.ExpiryDate.ToShortDateString()</td>
                                                <td>
                                                    <span
                                                        class="badge @(medicine.ExpiryDate < DateTime.Now ? "bg-danger" : "bg-success")">
                                                        @(medicine.ExpiryDate < DateTime.Now ? "Expired" : "In Stock")
                                                    </span>
                                                </td>

                                            </tr>
                                        }
                                    </tbody>
                                </table>



                            </div>


                        </div>

                    </div>


                </div>





            </div>



        </div>
    </div>
</div>

<!-- Modal for Adding New Medicine -->
<div class="modal fade" id="addMedicineModal" tabindex="-1" aria-labelledby="addMedicineModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMedicineModalLabel">Add New Medicine</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label for="medicineName" class="form-label">Medicine Name</label>
                        <input type="text" class="form-control" id="medicineName" name="MedicineName" required>
                        <div class="invalid-feedback">Please enter the medicine name.</div>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <select class="form-control" id="type" name="Type" required>
                            <option value="Tablet">Tablet</option>
                            <option value="Syrup">Syrup</option>
                            <option value="Injection">Injection</option>
                        </select>
                        <div class="invalid-feedback">Please select the medicine type.</div>
                    </div>
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="Quantity" required>
                        <div class="invalid-feedback">Please enter the quantity.</div>
                    </div>
                    <div class="mb-3">
                        <label for="expiryDate" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control" id="expiryDate" name="ExpiryDate" required>
                        <div class="invalid-feedback">Please select the expiry date.</div>
                    </div>
                    <button type="submit" class="btn btn-success">Add Medicine</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Expired Medicines -->
<div class="modal fade" id="expiredMedicineModal" tabindex="-1" aria-labelledby="expiredMedicineModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="expiredMedicineModalLabel">Expired Medicines</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Display expired medicines here...</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle More Actions visibility
        document.getElementById('moreActionsBtn').addEventListener('click', function () {
            const moreActions = document.getElementById('moreActions');
            moreActions.style.display = moreActions.style.display === 'none' ? 'block' : 'none';
        });

        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })();
    </script>

    <script>
        // Search Filter Logic
        document.getElementById('searchMedicine').addEventListener('input', function () {
            const filterValue = this.value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTableBody tr');

            rows.forEach(row => {
                const nameCell = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                const typeCell = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (nameCell.includes(filterValue) || typeCell.includes(filterValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Filter by Type Logic
        document.getElementById('filterType').addEventListener('change', function () {
            const selectedType = this.value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTableBody tr');

            rows.forEach(row => {
                const typeCell = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (selectedType === "" || typeCell === selectedType) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Sorting Logic for Expiry Date
        document.getElementById('sortExpiryBtn').addEventListener('click', function () {
            const rows = Array.from(document.querySelectorAll('#inventoryTableBody tr'));
            rows.sort((rowA, rowB) => {
                const expiryA = new Date(rowA.querySelector('td:nth-child(4)').textContent);
                const expiryB = new Date(rowB.querySelector('td:nth-child(4)').textContent);
                return expiryA - expiryB;
            });

            rows.forEach(row => document.querySelector('#inventoryTableBody').appendChild(row));
        });

        // Delete Medicine Function
        function deleteMedicine(medicineName) {
            if (confirm(`Are you sure you want to delete ${medicineName}?`)) {
                // Implement deletion logic here, for example, sending a request to the server
                alert(`Medicine ${medicineName} deleted.`);
            }
        }

        // Edit Medicine Modal (Fill in values)
        function setEditModalValues(name, type, quantity, expiryDate) {
            document.getElementById('editMedicineName').value = name;
            document.getElementById('editType').value = type;
            document.getElementById('editQuantity').value = quantity;
            document.getElementById('editExpiryDate').value = expiryDate;
        }

    </script>
}
