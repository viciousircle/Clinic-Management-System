@page
@model OOP_Final_Project.Pages.Inventory.InventoryManagementModel
@{
    ViewData["Title"] = "Inventory Management";
}


<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>


<style>
    body {
        background-color: #f7f8ff;
        color: #195478;

    }

    .rounded-12px {
        border-radius: 12px;
    }

    .rounded-16px {
        border-radius: 16px;
    }

    .rounded-24px {
        border-radius: 24px;
    }

    .hover-effect:hover {
        background-color: #d7dbe1;
    }
</style>

<div class=" pt-3 mt-5" style="background-color: #f7f8ff; font-family: Poppins, sans-serif; ">
    <div class="d-flex gap-3 min-vh-100">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-flex flex-column ps-5">
            <div class="pt-2 mt-5">
                <div class="mb-4 text-center" style="font-family: Libre Baskerville, serif;">
                    <h4><i>Welcome back, <b>Dr. Doe</b></i></h4>
                </div>
                <hr class="">
                <div class="nav flex-column ">
                    <a href="@Url.Page("/Inventory/InventoryDashBoard")"
                        class="nav-link px-3 py-2 mb-2 hover-effect rounded-16px d-flex gap-4 align-items-sm-center"
                        style="color: #195478;">
                        <i class="fas fa-home"></i> Dashboard
                    </a>

                    <a href="@Url.Page("/Inventory/PrescribeManagement")"
                        class="nav-link px-3 py-2 mb-2  hover-effect rounded-16px d-flex align-items-sm-center gap-4 "
                        style="color: #195478;">
                        <i class="fas fa-prescription-bottle-alt"></i> Prescribe
                    </a>
                    <a href="@Url.Page("/Inventory/InventoryManagement")"
                        class="nav-link px-3 py-2 mb-2  hover-effect rounded-16px d-flex align-items-sm-center gap-4"
                        style="color: #195478;">
                        <i class="fas fa-box-open me-2"></i> Warehouse
                    </a>
                    <a href="@Url.Page("/Doctors/DoctorSchedule")"
                        class="nav-link px-3 py-2 mb-2 hover-effect rounded-16px d-flex align-items-sm-center gap-4"
                        style="color: #195478;">
                        <i class="far fa-clock"></i> Schedule
                    </a>
                    <a href="#"
                        class="nav-link px-3 py-2 mb-2 hover-effect rounded-16px d-flex align-items-sm-center gap-4"
                        style="color: #195478;">
                        <i class="fas fa-sign-out-alt"></i> Log out
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class=" pt-3 mx-5 mt-5 shadow-lg w-100" style="border-top-left-radius: 48px; border-top-right-radius: 48px; background-color: #fefefe;
        box-shadow: 0 0 10px rgba(23, 23, 27, 0.1); 
            ">
            <div class="px-5">
                <!-- Header Section -->
                <div class=" " style="padding-top: 64px;">
                    <div class="  d-flex justify-content-between align-items-center mb-4">
                        <h3 class="mb-0">Warehouse</h3>

                        <div>
                            <!-- Action Buttons Group -->
                            <div class="">
                                <div class="d-flex justify-content-center gap-md-1">

                                    <button class="btn btn-outline-dark" data-bs-toggle="modal"
                                        data-bs-target="#addMedicineModal">
                                        <i class="fas fa-plus-circle me-2"></i> Add New
                                    </button>
                                    <button class="btn btn btn-success ">
                                        <i class="fas fa-file-import me-2"></i> Import Excel
                                    </button>
                                    <button class="btn btn-outline-danger ">
                                        <i class="fas fa-file-export me-2"></i> Export PDF
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <hr>

                <!-- Statistics Section -->
                <div class="my-4 d-flex flex-wrap gap-md-1">
                    <!-- Total Appointments -->
                    <div class="col-md-2 d-flex flex-column " style="flex: 1 0 auto; width: 16.66666667%;">
                        <div class="card quick-access-card text-center shadow-sm"
                            style="background-color: white; border-radius: 16px;">
                            <div class="card-body p-3 pb-2 d-flex flex-column g-2">
                                <div class="d-flex flex-column align-items-start gap-md-2" style="align-items: center;">
                                    <div class="text-muted">Total Medicines</div>
                                    <div class="d-flex gap-md-3 align-items-center w-100"
                                        style="justify-content: space-between;">
                                        <h3 class="mb-0 pb-0 ">500</h3>
                                        <small class="text-muted">
                                            <i class="fas fa-cubes"></i> Stock 20.000
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Future Appointments -->
                    <div class="col-md-3 d-flex flex-column">
                        <div class="card quick-access-card text-center shadow-sm"
                            style="background-color: white; border-radius: 16px;">
                            <div class="card-body p-3 pb-2 d-flex flex-column g-2">
                                <div class="d-flex flex-column align-items-start gap-md-2" style="align-items: center;">
                                    <div class="text-muted">Expiring Soon</div>
                                    <div class="d-flex w-100 align-items-center"
                                        style="justify-content: space-between;">
                                        <h3 class="mb-0">200</h3>
                                        <small class="text-muted">in the next 30 days</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Completed Appointments -->
                    <div class="col-md-3 d-flex flex-column">
                        <div class="card quick-access-card text-center shadow-sm"
                            style="background-color: white; border-radius: 16px;">
                            <div class="card-body p-3 pb-2 d-flex flex-column g-2">
                                <div class="d-flex flex-column align-items-start gap-md-2" style="align-items: center;">
                                    <div class="text-muted">Low Stock</div>
                                    <div class="d-flex align-items-center w-100"
                                        style="justify-content: space-between;">
                                        <h3 class="mb-0 text-warning">30</h3>
                                        <small class="text-muted">
                                            <i class="fab fa-stack-overflow"></i> Need To restock
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cancelled Appointments -->
                    <div class="col-md-3 d-flex flex-column">
                        <div class="card quick-access-card text-center shadow-sm"
                            style="background-color: white; border-radius: 16px;">
                            <div class="card-body p-3 pb-2 d-flex flex-column ">
                                <div class="d-flex flex-column align-items-start gap-md-2" style="align-items: center;">
                                    <div class="text-muted">Expired</div>
                                    <div class="d-flex  align-items-center w-100"
                                        style="justify-content: space-between;">
                                        <h3 class="mb-0 text-danger">120</h3>
                                        <small class="text-muted">
                                            <i class="fas fa-trash-alt"></i> Need to remove
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Appointments Section -->
                <div class="card rounded-16px mb-4 shadow-sm p-4" style="background-color: #ffffff;">
                    <!-- Filters and Buttons -->
                    <div class="d-flex flex-column">

                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div class="d-flex gap-md-2">
                                <!-- View Options -->
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn  btn-dark ">View All</button>
                                    <button type="button" class="btn btn-outline-dark">Low stock</button>
                                    <button type="button" class="btn btn-outline-dark  ">Expired</button>
                                </div>

                        @* TODO *@

                                <!-- Sort Options -->
                                <div>
                                    <select id="sortTime" class="form-select w-auto " onchange="sortAppointments()">
                                        <option value="" class="text-dark">Filter None</option>
                                        <option value="Tablet" class="text-dark">Tablet</option>
                                        <option value="Syrup" class="text-dark">Syrup</option>
                                        <option value="Injection" class="text-dark">Injection</option>
                                    </select>
                                </div>

                         @* TODO: Cái này chỉ hiện khi ấn vào view all hoặc previous thôi *@
                                <!-- Date Filter -->
                                <div>
                                    <button class="btn border-secondary w-100" id="sortExpiryBtn">
                                        <i class="fas fa-sort me-2"></i> Sort by Expiry Date
                                    </button>
                                </div>

                            </div>

                            <!-- Search Input -->
                            <div class="input-group w-25">
                                <span class="input-group-text text-muted">
                                    <i class="fas fa-search"></i>
                                </span>

                                <input type="text" class="form-control" placeholder="Search">
                            </div>
                        </div>
                    </div>

                    <!-- Appointments Table -->
                    <table class="table table-hover table-bordered shadow-sm text-center " id="appointmentsTable">
                        <thead class="table-light">
                            <tr>
                                <th style="font-weight: 600;">Medicine Name</th>
                                <th style="font-weight: 600;">Type</th>
                                <th style="font-weight: 600;">Import date</th>
                                <th style="font-weight: 600;">Expired date</th>
                                <th style="font-weight: 600;">Quantity</th>
                                <th style="font-weight: 600;">Action</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr class="align-middle">
                                <td>PatientName</td>
                                <td>Appointme</td>
                                <td>AppointmentTime</td>
                                <td>Reason</td>
                                <td>Reason</td>
                                <td>
                                    <button class="btn btn-outline-danger btn-sm"
                                        onclick="openHealthCheckModal(this)">Remove</button>
                                </td>
                            </tr>

                        </tbody>


                    </table>
                </div>

            </div>
        </div>


    </div>
</div>

<div class="modal fade" id="healthCheckModal" tabindex="-1" aria-labelledby="healthCheckModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="healthCheckModalLabel">Health Check</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Perform the health check for the selected patient.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="markAsDone()">Mark as Done</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal for Adding New Medicine -->
<div class="modal fade" id="addMedicineModal" tabindex="-1" aria-labelledby="addMedicineModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMedicineModalLabel">Add New Medicine</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label for="medicineName" class="form-label">Medicine Name</label>
                        <input type="text" class="form-control" id="medicineName" name="MedicineName" required>
                        <div class="invalid-feedback">Please enter the medicine name.</div>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <select class="form-control" id="type" name="Type" required>
                            <option value="Tablet">Tablet</option>
                            <option value="Syrup">Syrup</option>
                            <option value="Injection">Injection</option>
                        </select>
                        <div class="invalid-feedback">Please select the medicine type.</div>
                    </div>
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="Quantity" required>
                        <div class="invalid-feedback">Please enter the quantity.</div>
                    </div>
                    <div class="mb-3">
                        <label for="expiryDate" class="form-label">Expiry Date</label>
                        <input type="date" class="form-control" id="expiryDate" name="ExpiryDate" required>
                        <div class="invalid-feedback">Please select the expiry date.</div>
                    </div>
                    <button type="submit" class="btn btn-success">Add Medicine</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <script>
        let selectedRow = null; // To store the selected row for marking as done


        function searchAppointments() {
            const searchInput = document.getElementById("searchInput").value.toLowerCase();
            const rows = document.querySelectorAll("#appointmentsTable tbody tr");

            rows.forEach(row => {
                const rowText = row.textContent.toLowerCase();
                row.style.display = rowText.includes(searchInput) ? "" : "none";
            });
        }

        function filterAppointmentsByDate() {
            const dateFilter = document.getElementById("dateFilter").value;
            const rows = document.querySelectorAll("#appointmentsTable tbody tr");

            rows.forEach(row => {
                const appointmentDate = row.cells[1].textContent; // Get appointment date from second column
                row.style.display = dateFilter && appointmentDate !== dateFilter ? "none" : "";
            });
        }

        function sortAppointments() {
            const sortOption = document.getElementById("sortTime").value;
            const table = document.getElementById("appointmentsTable");
            const rows = Array.from(table.querySelectorAll("tbody tr"));

            rows.sort((rowA, rowB) => {
                const timeA = rowA.cells[2].textContent; // Get appointment time from third column
                const timeB = rowB.cells[2].textContent;

                return sortOption === "asc" ? timeA.localeCompare(timeB) : timeB.localeCompare(timeA);
            });

            const tbody = table.querySelector("tbody");
            rows.forEach(row => tbody.appendChild(row));
        }

        function openHealthCheckModal(button) {
            // Store the selected row
            selectedRow = button.closest("tr");

            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('healthCheckModal'));
            modal.show();
        }

        function markAsDone() {
            if (selectedRow) {
                // Update the status cell to "Completed Health Check"
                const statusCell = selectedRow.cells[4];
                statusCell.innerHTML = '<span class="btn btn-sm btn-success">Completed</span>';

                // Move the row to the end of the table body
                const tableBody = selectedRow.parentElement;
                tableBody.appendChild(selectedRow);

                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('healthCheckModal'));
                modal.hide();

                // Reset the selected row
                selectedRow = null;
            }
        }
    </script>

    <script>
        // Toggle More Actions visibility
        document.getElementById('moreActionsBtn').addEventListener('click', function () {
            const moreActions = document.getElementById('moreActions');
            moreActions.style.display = moreActions.style.display === 'none' ? 'block' : 'none';
        });

        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })();
    </script>

    <script>
        // Search Filter Logic
        document.getElementById('searchMedicine').addEventListener('input', function () {
            const filterValue = this.value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTableBody tr');

            rows.forEach(row => {
                const nameCell = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                const typeCell = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (nameCell.includes(filterValue) || typeCell.includes(filterValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Filter by Type Logic
        document.getElementById('filterType').addEventListener('change', function () {
            const selectedType = this.value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTableBody tr');

            rows.forEach(row => {
                const typeCell = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (selectedType === "" || typeCell === selectedType) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Sorting Logic for Expiry Date
        document.getElementById('sortExpiryBtn').addEventListener('click', function () {
            const rows = Array.from(document.querySelectorAll('#inventoryTableBody tr'));
            rows.sort((rowA, rowB) => {
                const expiryA = new Date(rowA.querySelector('td:nth-child(4)').textContent);
                const expiryB = new Date(rowB.querySelector('td:nth-child(4)').textContent);
                return expiryA - expiryB;
            });

            rows.forEach(row => document.querySelector('#inventoryTableBody').appendChild(row));
        });

        // Delete Medicine Function
        function deleteMedicine(medicineName) {
            if (confirm(`Are you sure you want to delete ${medicineName}?`)) {
                // Implement deletion logic here, for example, sending a request to the server
                alert(`Medicine ${medicineName} deleted.`);
            }
        }

        // Edit Medicine Modal (Fill in values)
        function setEditModalValues(name, type, quantity, expiryDate) {
            document.getElementById('editMedicineName').value = name;
            document.getElementById('editType').value = type;
            document.getElementById('editQuantity').value = quantity;
            document.getElementById('editExpiryDate').value = expiryDate;
        }

    </script>
}
