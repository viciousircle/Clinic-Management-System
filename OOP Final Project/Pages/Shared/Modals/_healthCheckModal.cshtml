<div class="modal fade" id="healthCheckModal" tabindex="-1" aria-labelledby="healthCheckModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="healthCheckModalLabel">Health Check</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row overflow-auto" style="overflow-y: scroll;">
                    <div class="accordion" id="accordionExample">
                        <!-- Patient Information Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingPatientInfo">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapsePatientInfo" aria-expanded="true"
                                    aria-controls="collapsePatientInfo">
                                    Patient Information
                                </button>
                            </h2>
                            <div id="collapsePatientInfo" class="accordion-collapse collapse show"
                                aria-labelledby="headingPatientInfo" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="patientInfo">
                                    <form id="healthCheckForm">
                                        <div class="mb-3">
                                            <label for="patientName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="patientName" placeholder="N/A"
                                                autocomplete="off" required disabled>
                                            <div class="invalid-feedback">Name is required.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="patientAge" class="form-label">Age</label>
                                            <input type="number" class="form-control" id="patientAge" placeholder="N/A"
                                                required disabled>
                                            <div class="invalid-feedback">Age is required.</div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Symptoms Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSymptoms">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseSymptoms" aria-expanded="false"
                                    aria-controls="collapseSymptoms">
                                    Symptoms
                                </button>
                            </h2>
                            <div id="collapseSymptoms" class="accordion-collapse collapse"
                                aria-labelledby="headingSymptoms" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="symptoms">
                                    <textarea class="form-control" id="symptomsInput" rows="4"
                                        placeholder="Describe symptoms"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Health Records Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingHealthRecords">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseHealthRecords" aria-expanded="false"
                                    aria-controls="collapseHealthRecords">
                                    Health Records
                                </button>
                            </h2>
                            <div id="collapseHealthRecords" class="accordion-collapse collapse"
                                aria-labelledby="headingHealthRecords" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="healthRecords">
                                    <div class="mb-3">
                                        <label for="temperature" class="form-label">Temperature (°C)</label>
                                        <input type="number" class="form-control" id="temperature" placeholder="N/A">
                                    </div>

                                    <div class="mb-3">
                                        <label for="bloodPressure" class="form-label">Blood Pressure</label>
                                        <input type="text" class="form-control" id="bloodPressure" placeholder="N/A">
                                    </div>

                                    <div class="mb-3">
                                        <label for="pulseRate" class="form-label">Pulse Rate</label>
                                        <input type="number" class="form-control" id="pulseRate" placeholder="N/A">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Diagnosis Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingDiagnosis">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseDiagnosis" aria-expanded="false"
                                    aria-controls="collapseDiagnosis">
                                    Diagnosis
                                </button>
                            </h2>
                            <div id="collapseDiagnosis" class="accordion-collapse collapse"
                                aria-labelledby="headingDiagnosis" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="diagnosis">
                                    <textarea class="form-control" id="diagnosisInput" rows="4"
                                        placeholder="Doctor's diagnosis"></textarea>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" id="needPrescriptionCheck"
                                            onclick="togglePrescription()">
                                        <label class="form-check-label" for="needPrescriptionCheck">
                                            Patient needs prescription
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Prescription Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingPrescription">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapsePrescription" aria-expanded="false"
                                    aria-controls="collapsePrescription">
                                    Prescription
                                </button>
                            </h2>
                            <div id="collapsePrescription" class="accordion-collapse collapse"
                                aria-labelledby="headingPrescription" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="prescription">
                                    <button type="button" class="btn btn-outline-dark w-100 mb-3"
                                        onclick="addMedicine()">Add
                                        Medicine</button>
                                    <div id="medicinesContainer">
                                        <!-- Dynamic medicine fields will be added here -->
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- Commit & Rules Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingCommitAndRules">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseCommitAndRules" aria-expanded="false"
                                    aria-controls="collapseCommitAndRules">
                                    Commit & Rules
                                </button>
                            </h2>
                            <div id="collapseCommitAndRules" class="accordion-collapse collapse"
                                aria-labelledby="headingCommitAndRules" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="commitAndRules">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rule1" required>
                                        <label class="form-check-label" for="rule1">
                                            Rule 1: Ensure patient consent is obtained. This is crucial to protect both
                                            the patient's rights and the healthcare provider's responsibility.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rule2" required>
                                        <label class="form-check-label" for="rule2">
                                            Rule 2: Verify all entered data is correct, including medical history,
                                            symptoms, and diagnostic details.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rule3" required>
                                        <label class="form-check-label" for="rule3">
                                            Rule 3: Follow hospital guidelines strictly. This includes adhering to
                                            protocols for patient care and medical record keeping.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rule4" required>
                                        <label class="form-check-label" for="rule4">
                                            Rule 4: Ensure thorough understanding of treatment plans before prescribing
                                            or recommending them.
                                        </label>
                                    </div>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" id="confirmCheck"
                                            onclick="toggleMarkAsDone()">
                                        <label class="form-check-label" for="confirmCheck">
                                            I have read and made sure all the above rules are followed.
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="markAsDoneBtn" onclick="markAsDone()" disabled>Mark as
                    Done</button>
            </div>
        </div>
    </div>
</div>

<style>
    .dropdown-container {
        position: relative;
    }

    .dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        z-index: 1000;
    }
</style>



<script>
    const medicines = [
        "Paracetamol",
        "Ibuprofen",
        "Amoxicillin",
        "Ciprofloxacin",
        "Metformin",
        "Amlodipine",
        "Simvastatin",
        "Omeprazole",
        "Lisinopril",
        "Levothyroxine"
    ];

    // Function to add a new medicine input field
    function addMedicine() {
        const medicinesContainer = document.getElementById('medicinesContainer');
        const medicineIndex = medicinesContainer.children.length;

        const medicineDiv = document.createElement('div');
        medicineDiv.classList.add('mb-3');
        medicineDiv.innerHTML = `
            <div class="input-group mb-3 dropdown-container">
                <input type="text" class="form-control" placeholder="Search medicine" id="medicineName${medicineIndex}" oninput="searchMedicine(${medicineIndex})">
                <div class="list-group dropdown-list" id="medicineList${medicineIndex}"></div>
                <input type="text" class="form-control" placeholder="Dosage Amount" id="dosageAmount${medicineIndex}">
                <input type="text" class="form-control" placeholder="Frequency" id="frequency${medicineIndex}">
                <input type="text" class="form-control" placeholder="Frequency Unit" id="frequencyUnit${medicineIndex}">
                <input type="text" class="form-control" placeholder="Route" id="route${medicineIndex}">
                <input type="text" class="form-control" placeholder="Instructions" id="instructions${medicineIndex}">
                <button class="btn btn-danger" type="button" onclick="removeMedicine(this)">Remove</button>
            </div>
        `;
        medicinesContainer.appendChild(medicineDiv);
    }

    // Function to search for medicines
    function searchMedicine(index) {
        const input = document.getElementById(`medicineName${index}`);
        const filter = input.value.toLowerCase();
        const list = document.getElementById(`medicineList${index}`);
        list.innerHTML = '';

        if (filter) {
            const filteredMedicines = medicines.filter(medicine => medicine.toLowerCase().includes(filter));
            filteredMedicines.forEach(medicine => {
                const item = document.createElement('button');
                item.type = 'button';
                item.classList.add('list-group-item', 'list-group-item-action');
                item.textContent = medicine;
                item.onclick = () => {
                    input.value = medicine;
                    list.innerHTML = '';
                };
                list.appendChild(item);
            });
        }
    }

    // Function to remove a medicine input field
    function removeMedicine(button) {
        button.parentElement.parentElement.remove();
    }

    // Mark form as done and log the data including new fields
    function markAsDone() {
        const formData = {
            patientName: document.getElementById('patientName').value,
            patientAge: document.getElementById('patientAge').value,
            symptoms: document.getElementById('symptomsInput').value,
            temperature: document.getElementById('temperature').value,
            bloodPressure: document.getElementById('bloodPressure').value,
            pulseRate: document.getElementById('pulseRate').value,
            diagnosis: document.getElementById('diagnosisInput').value,
            prescription: Array.from(document.querySelectorAll('#medicinesContainer .input-group')).map(group => ({
                name: group.querySelector('input[id^="medicineName"]').value,
                dosageAmount: group.querySelector('input[id^="dosageAmount"]').value,
                frequency: group.querySelector('input[id^="frequency"]').value,
                frequencyUnit: group.querySelector('input[id^="frequencyUnit"]').value,
                route: group.querySelector('input[id^="route"]').value,
                instructions: group.querySelector('input[id^="instructions"]').value
            })),
            rulesChecked: Array.from(document.querySelectorAll('#commitAndRules input:checked')).map(
                (checkbox) => checkbox.labels[0].innerText
            )
        };

        console.log("Form Data:", formData);
        alert("Health check marked as done!");

        // Reset modal and close
        resetForm();
        document.querySelector('#healthCheckModal .btn-close').click();
    }

    // Enable prescription input if the checkbox is checked
    function togglePrescription() {
        const needPrescriptionCheck = document.getElementById('needPrescriptionCheck');
        const prescriptionSection = document.getElementById('collapsePrescription');
        const addMedicineBtn = document.querySelector('#collapsePrescription .btn');

        if (needPrescriptionCheck.checked) {
            prescriptionSection.classList.add('show');
            addMedicineBtn.classList.remove('btn-secondary');
            addMedicineBtn.classList.add('btn-outline-dark');
        } else {
            prescriptionSection.classList.remove('show');
            addMedicineBtn.classList.remove('btn-outline-dark');
            addMedicineBtn.classList.add('btn-secondary');
        }
    }

    // Enable "Mark as Done" button if all checkboxes are checked
    function toggleMarkAsDone() {
        const confirmCheck = document.getElementById('confirmCheck');
        const markAsDoneBtn = document.getElementById('markAsDoneBtn');

        markAsDoneBtn.disabled = !confirmCheck.checked;
    }

    // Function to reset the form
    function resetForm() {
        document.getElementById('patientName').value = '';
        document.getElementById('patientAge').value = '';
        document.getElementById('symptomsInput').value = '';
        document.getElementById('diagnosisInput').value = '';
        document.getElementById('medicinesContainer').innerHTML = '';
        document.getElementById('confirmCheck').checked = false;
        toggleMarkAsDone();
    }
</script>
