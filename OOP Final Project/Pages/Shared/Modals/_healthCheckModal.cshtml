<div class="modal fade" id="healthCheckModal" tabindex="-1" aria-labelledby="healthCheckModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="healthCheckModalLabel">Health Check</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="accordion" id="healthCheckAccordion">
                    <!-- Patient Information -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingHealthCheckPatientInfo">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseHealthCheckPatientInfo" aria-expanded="true"
                                aria-controls="collapseHealthCheckPatientInfo">
                                Patient Information
                            </button>
                        </h2>
                        <div id="collapseHealthCheckPatientInfo" class="accordion-collapse collapse show"
                            data-bs-parent="#healthCheckAccordion">
                            <div class="accordion-body">
                                <form id="healthCheckPatientInfoForm">
                                    <div class="d-flex" style="gap: 2rem;">
                                        <div class="d-flex gap-md-2 flex-column w-100">
                                            <div class="mb-3">
                                                <label for="healthCheckPatientID" class="form-label">ID</label>
                                                <input type="number" class="form-control text-muted"
                                                    id="healthCheckPatientID" placeholder="N/A" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="healthCheckPatientName" class="form-label">Full
                                                    Name</label>
                                                <input type="text" class="form-control text-muted"
                                                    id="healthCheckPatientName" placeholder="N/A" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="healthCheckPatientPhone" class="form-label">Phone</label>
                                                <input type="text" class="form-control text-muted"
                                                    id="healthCheckPatientPhone" placeholder="N/A" disabled>
                                            </div>
                                        </div>

                                        <div class="d-flex gap-md-2 flex-column w-100">

                                            <div class="mb-3">
                                                <label for="healthCheckPatientEmail" class="form-label">Email</label>
                                                <input type="text" class="form-control text-muted"
                                                    id="healthCheckPatientEmail" placeholder="N/A" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="healthCheckPatientAddress"
                                                    class="form-label">Address</label>
                                                <input type="text" class="form-control text-muted"
                                                    id="healthCheckPatientAddress" placeholder="N/A" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="healthCheckPatientLatestVisit" class="form-label">Latest
                                                    Visit</label>
                                                <input type="text" class="form-control text-muted"
                                                    id="healthCheckPatientLatestVisit" placeholder="N/A" disabled>
                                            </div>

                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Symptoms Section -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingSymptoms">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseSymptoms" aria-expanded="false"
                                aria-controls="collapseSymptoms">
                                Reason for Visit
                            </button>
                        </h2>
                        <div id="collapseSymptoms" class="accordion-collapse collapse"
                            data-bs-parent="#healthCheckAccordion">
                            <div class="accordion-body">
                                <textarea class="form-control" id="healthCheckPatientReason" rows="4"
                                    placeholder="Describe symptoms"></textarea>
                            </div>
                        </div>
                    </div>


                    <!-- Diagnosis Section -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingDiagnosis">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseDiagnosis" aria-expanded="false"
                                aria-controls="collapseDiagnosis">
                                Diagnosis
                            </button>
                        </h2>
                        <div id="collapseDiagnosis" class="accordion-collapse collapse"
                            data-bs-parent="#healthCheckAccordion">
                            <div class="accordion-body" id="diagnosis">
                                <textarea class="form-control" id="diagnosisInput" rows="4"
                                    placeholder="Doctor's diagnosis"></textarea>
                                <div class="form-check mt-3">
                                    <input class="form-check-input" type="checkbox" id="needPrescriptionCheck"
                                        onclick="togglePrescription()">
                                    <label class="form-check-label" for="needPrescriptionCheck">
                                        Patient needs prescription
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prescription Section -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingPrescription">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapsePrescription" aria-expanded="false"
                                aria-controls="collapsePrescription">
                                Prescription
                            </button>
                        </h2>
                        <div id="collapsePrescription" class="accordion-collapse collapse"
                            data-bs-parent="#healthCheckAccordion">
                            <div class="accordion-body" id="prescription">
                                <button type="button" class="btn btn-secondary w-100 mb-3" onclick="addMedicine()"
                                    disabled>
                                    Add Medicine
                                </button>
                                <div id="medicinesContainer">
                                    <!-- Dynamic medicine fields will be added here -->
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="markAsDoneBtn" onclick="markAsDone()">Mark as
                    Done</button>
            </div>
        </div>
    </div>
</div>

<style>
    .dropdown-container {
        position: relative;
    }

    .dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        z-index: 1000;
    }
</style>

<script>
    const medicines = [
        "Paracetamol",
        "Ibuprofen",
        "Amoxicillin",
        "Ciprofloxacin",
        "Metformin",
        "Amlodipine",
        "Simvastatin",
        "Omeprazole",
        "Lisinopril",
        "Levothyroxine"
    ];

    // Function to add a new medicine input field
    function addMedicine() {
        const medicinesContainer = document.getElementById('medicinesContainer');
        const medicineIndex = medicinesContainer.children.length;

        const medicineDiv = document.createElement('div');
        medicineDiv.classList.add('mb-3');
        medicineDiv.innerHTML = `
            <div class="input-group mb-3 dropdown-container">
                <input type="text" class="form-control" placeholder="Search medicine" id="medicineName${medicineIndex}" oninput="searchMedicine(${medicineIndex})">
                <div class="list-group dropdown-list" id="medicineList${medicineIndex}"></div>
                <input type="text" class="form-control" placeholder="Dosage Amount" id="dosageAmount${medicineIndex}">
                <input type="text" class="form-control" placeholder="Frequency" id="frequency${medicineIndex}">
                <input type="text" class="form-control" placeholder="Frequency Unit" id="frequencyUnit${medicineIndex}">
                <input type="text" class="form-control" placeholder="Route" id="route${medicineIndex}">
                <input type="text" class="form-control" placeholder="Instructions" id="instructions${medicineIndex}">
                <button class="btn btn-danger" type="button" onclick="removeMedicine(this)">Remove</button>
            </div>
        `;
        medicinesContainer.appendChild(medicineDiv);
    }

    // Function to search for medicines
    function searchMedicine(index) {
        const input = document.getElementById(`medicineName${index}`);
        const filter = input.value.toLowerCase();
        const list = document.getElementById(`medicineList${index}`);
        list.innerHTML = '';

        if (filter) {
            const filteredMedicines = medicines.filter(medicine => medicine.toLowerCase().includes(filter));
            filteredMedicines.forEach(medicine => {
                const item = document.createElement('button');
                item.type = 'button';
                item.classList.add('list-group-item', 'list-group-item-action');
                item.textContent = medicine;
                item.onclick = () => {
                    input.value = medicine;
                    list.innerHTML = '';
                };
                list.appendChild(item);
            });
        }
    }

    // Function to remove a medicine input field
    function removeMedicine(button) {
        button.parentElement.parentElement.remove();
    }

    // Mark form as done and log the data including new fields
    function markAsDone() {
        const formData = {
            patientName: document.getElementById('healthCheckPatientName').value,
            patientAge: document.getElementById('healthCheckPatientAge').value,
            symptoms: document.getElementById('symptomsInput').value,
            temperature: document.getElementById('temperature').value,
            bloodPressure: document.getElementById('bloodPressure').value,
            pulseRate: document.getElementById('pulseRate').value,
            diagnosis: document.getElementById('diagnosisInput').value,
            prescription: Array.from(document.querySelectorAll('#medicinesContainer .input-group')).map(group => ({
                name: group.querySelector('input[id^="medicineName"]').value,
                dosageAmount: group.querySelector('input[id^="dosageAmount"]').value,
                frequency: group.querySelector('input[id^="frequency"]').value,
                frequencyUnit: group.querySelector('input[id^="frequencyUnit"]').value,
                route: group.querySelector('input[id^="route"]').value,
                instructions: group.querySelector('input[id^="instructions"]').value
            }))
        };

        console.log("Form Data:", formData);
        alert("Health check marked as done!");

        // Reset modal and close
        resetForm();
        document.querySelector('#healthCheckModal .btn-close').click();
    }

    // Enable prescription input if the checkbox is checked
    function togglePrescription() {
        const needPrescriptionCheck = document.getElementById('needPrescriptionCheck');
        const addMedicineBtn = document.querySelector('#collapsePrescription .btn');

        if (needPrescriptionCheck.checked) {
            addMedicineBtn.classList.remove('btn-secondary');
            addMedicineBtn.classList.add('btn-outline-dark');
            addMedicineBtn.disabled = false;
        } else {
            addMedicineBtn.classList.remove('btn-outline-dark');
            addMedicineBtn.classList.add('btn-secondary');
            addMedicineBtn.disabled = true;
        }
    }

    // Function to reset the form
    function resetForm() {
        document.getElementById('healthCheckPatientName').value = '';
        document.getElementById('healthCheckPatientAge').value = '';
        document.getElementById('symptomsInput').value = '';
        document.getElementById('diagnosisInput').value = '';
        document.getElementById('medicinesContainer').innerHTML = '';
    }
</script>