<div class="modal fade" id="newAppointmentModal" tabindex="-1" aria-labelledby="newAppointmentModalLabel">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 80%;"> <!-- Custom size for modal -->
        <div class="modal-content" style="border-radius: 16px;">
            <div class="modal-header">
                <h5 class="modal-title" id="newAppointmentModalLabel">New Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Left Column (Patient Info) -->
                    <div class="col-md-6 position-relative">
                        <!-- Patient info will be displayed here -->
                        <div class="input-group mb-3">
                            <span class="input-group-text ">Patient</span>
                            <input type="text" class="form-control" id="patientSearch" placeholder="Enter patient info"
                                oninput="handlePatientSearchInput()" autocomplete="off">
                        </div>
                        <div style="display: flex; justify-content: center;">
                            <!-- The dropdown will be placed here -->
                            <div id="patientDropdown" class="list-group shadow-sm"
                                style="max-height: 200px; overflow-y: auto; display: none; position: absolute; z-index: 1050; width: 90%; ">
                            </div>
                        </div>

                        <!-- Patient Info (Initially Hidden) -->
                        <div id="patientInfo" class="d-flex flex-column gap-md-2" style="display: none;">
                            <div class="d-flex" style="align-items: center;">
                                <label for="patientId" class="form-label text-muted mb-0 pe-2 w-25">ID</label>
                                <input class="form-control text-muted" type="text" id="patientId" placeholder="N/A"
                                    disabled>
                            </div>
                            <div class="d-flex" style="justify-content:flex-start; align-items: center;">
                                <label for="patientName" class="form-label text-muted mb-0 pe-2 w-25">Full Name</label>
                                <input class="w-100 form-control text-muted" type="text" id="patientName"
                                    placeholder="N/A" disabled>
                            </div>
                            <div class="d-flex" style="align-items: center;">
                                <label for="patientLastVisit" class="form-label text-muted mb-0 w-25">Last Visit</label>
                                <input class="form-control text-muted" type="text" id="patientLastVisit"
                                    placeholder="N/A" disabled>
                            </div>
                            <div class="d-flex" style="align-items: center;">
                                <label for="patientPhone" class="form-label text-muted mb-0 w-25">Phone</label>
                                <input class="form-control text-muted" type="text" id="patientPhone" placeholder="N/A"
                                    disabled>
                            </div>
                            <div class="d-flex flex-column w-100" style="align-items: center;">
                                <label class="form-label text-muted mb-2">Latest Diagnose</label>
                                <input class="form-control text-muted" type="text" id="patientDiagnose"
                                    placeholder="N/A" disabled>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column (Appointment Info) -->
                    <div id="appointmentInfoContainer" style="display: none;" class="col-md-6">
                        <div>
                            <!-- Doctor/Provider Selection -->
                            <div class="mb-3">
                                @* <label for="doctor" class="form-label">Doctor</label> *@
                                <select class="form-select" id="doctor" aria-label="Disabled select example" disabled>
                                    <option value="Dr. John Smith" selected>Dr. John Smith</option>
                                    <option value="Dr. Jane Doe">Dr. Jane Doe</option>
                                    <option value="Dr. Emily White">Dr. Emily White</option>
                                </select>
                            </div>

                            <!-- Appointment Date -->
                            <div class="mb-3 d-flex gap-md-2" style="align-items: center;">
                                <label for="appointmentDate" class="form-label w-75">Appointment Date</label>
                                <input type="date" class="form-control" id="appointmentDate" required>
                                <small class="text-danger d-none" id="dateError">Please select a valid date.</small>
                            </div>

                            <!-- Appointment Time -->
                            <div class="mb-3 d-flex gap-md-2" style="align-items: center;">
                                <label for="appointmentTime" class="form-label w-75">Appointment Time</label>
                                <select class="form-select" id="appointmentTime" required>
                                    <option value="" disabled selected>Select a time slot</option>
                                    <option value="7:00-8:00 AM">7:00 - 8:00 AM</option>
                                    <option value="8:00-9:00 AM" disabled>8:00 - 9:00 AM (Unavailable)</option>
                                    <option value="9:00-10:00 AM">9:00 - 10:00 AM</option>
                                </select>
                                <small class="text-danger d-none" id="timeError">Please select a valid time
                                    slot.</small>
                            </div>

                            <!-- Reason for Visit -->
                            <div class="mb-3">
                                <label for="reason" class="form-label">Reason</label>
                                <textarea class="form-control" id="reason" rows="4"
                                    placeholder="Describe the reason for the visit"></textarea>
                            </div>



                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveAppointmentBtn">Save Appointment</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Sample patient data (replace with actual data fetching logic)
    const patients = [
        { id: 1, name: "John Doe", age: 30, gender: "Male", lastVisit: "2023-12-10", phone: "123-456-7890" },
        { id: 2, name: "Jane Smith", age: 25, gender: "Female", lastVisit: "2023-12-05", phone: "987-654-3210" },
        { id: 3, name: "Michael Johnson", age: 40, gender: "Male", lastVisit: "2023-11-20", phone: "456-789-1234" }
    ];

    let patientSelected = false;

    // Function to handle patient search input
    function handlePatientSearchInput() {
        if (patientSelected) {
            const confirmChange = confirm("Changing the patient will delete the current patient information. Do you want to proceed?");
            if (!confirmChange) {
                document.getElementById('patientSearch').value = document.getElementById('patientName').value;
                return;
            } else {
                resetForm();
            }
        }
        searchPatients();
    }

    // Function to search for patients based on input
    function searchPatients() {
        const input = document.getElementById('patientSearch').value.trim().toLowerCase();
        const patientDropdown = document.getElementById('patientDropdown');

        // Clear dropdown and hide appointment info if no input
        if (input === "") {
            patientDropdown.style.display = "none";
            document.getElementById('appointmentInfoContainer').style.display = "none";
            return;
        }

        patientDropdown.innerHTML = ""; // Clear existing dropdown items
        document.getElementById('patientInfo').style.display = 'none'; // Hide patient info

        // Filter patients based on input
        const filteredPatients = patients.filter(patient =>
            patient.name.toLowerCase().includes(input) ||
            patient.age.toString().includes(input) ||
            patient.gender.toLowerCase().includes(input) ||
            patient.id.toString().includes(input)
        );

        if (filteredPatients.length > 0) {
            patientDropdown.style.display = "block"; // Show dropdown
            filteredPatients.forEach(patient => {
                const patientItem = document.createElement('button');
                patientItem.classList.add('list-group-item', 'list-group-item-action');
                patientItem.textContent = `ID: ${patient.id} - ${patient.name} - ${patient.age} years old, ${patient.gender}`;
                patientItem.onclick = () => selectPatient(patient);
                patientDropdown.appendChild(patientItem);
            });
        } else {
            patientDropdown.style.display = "none";
        }
    }

    // Function to select a patient
    function selectPatient(patient) {
        document.getElementById('patientSearch').value = patient.name;
        document.getElementById('patientName').value = patient.name;
        document.getElementById('patientId').value = patient.id;
        document.getElementById('patientLastVisit').value = patient.lastVisit || "N/A";
        document.getElementById('patientPhone').value = patient.phone || "N/A";
        document.getElementById('patientDiagnose').value = patient.diagnose || "N/A";

        document.getElementById('patientInfo').style.display = "block";
        document.getElementById('patientDropdown').style.display = "none";
        document.getElementById('appointmentInfoContainer').style.display = "block";

        patientSelected = true;
    }

    // Function to reset the form
    function resetForm() {
        document.getElementById('patientSearch').value = '';
        document.getElementById('patientName').value = 'N/A';
        document.getElementById('patientId').value = 'N/A';
        document.getElementById('patientLastVisit').value = 'N/A';
        document.getElementById('patientPhone').value = 'N/A';
        document.getElementById('patientDiagnose').value = 'N/A';

        document.getElementById('patientInfo').style.display = 'none';
        document.getElementById('appointmentInfoContainer').style.display = 'none';
        document.getElementById('patientDropdown').style.display = 'none';

        document.getElementById('appointmentDate').value = '';
        document.getElementById('appointmentTime').value = '';
        document.getElementById('reason').value = '';

        patientSelected = false;
    }

    // Appointment form validation
    document.getElementById('saveAppointmentBtn').addEventListener('click', () => {
        const date = document.getElementById('appointmentDate').value;
        const time = document.getElementById('appointmentTime').value;
        const dateError = document.getElementById('dateError');
        const timeError = document.getElementById('timeError');

        let isValid = true;

        if (!date) {
            dateError.classList.remove('d-none');
            isValid = false;
        } else {
            dateError.classList.add('d-none');
        }

        if (!time) {
            timeError.classList.remove('d-none');
            isValid = false;
        } else {
            timeError.classList.add('d-none');
        }

        if (isValid) {
            alert('Appointment saved successfully!');
            resetForm();
        }
    });
</script>